apply plugin: 'java'
apply plugin: 'kotlin'


import com.github.jengelman.gradle.plugins.shadow.tasks.ShadowJar

task executableJar(type: ShadowJar) {
  baseName = 'locallydynamic-server'
  classifier = 'standalone'
  from sourceSets.main.output
  configurations = [
          project.configurations.compile
  ]
  manifest {
    attributes 'Main-Class': 'com.jeppeman.locallydynamic.server.LocallyDynamicMainKt'
  }
}

test {
  useJUnitPlatform()
}

configurations {
  jarLibs
}

dependencies {
  compile deps.kotlin.stdlib
  compile deps.jetty.server
  compile deps.guava
  compile deps.gcp.storage
  compile deps.bundletool
  jarLibs deps.bundletool

//  compileOnly deps.bundletool_maven

  testCompile deps.junit.api
  testCompile deps.junit.params
  testCompile deps.junit.engine
  testCompile deps.junit.runner
  testCompile deps.mockito.core
  testCompile deps.mockito.jupiter
  testCompile deps.mockito.kotlin
  testCompile deps.truth
}

jar {
  archiveFileName = 'locallydynamic-server.jar'
  from {
    configurations.jarLibs.collect { it.isDirectory() ? it : zipTree(it) }
  }
}

apply from: rootProject.file('gradle/gradle-mvn-push.gradle')